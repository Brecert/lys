"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const nodes_1 = require("./nodes");
const NodeError_1 = require("./NodeError");
class ParsingContext {
    constructor() {
        this.programTakenNames = new Set();
        this.errors = [];
    }
    error(error, node) {
        if (error instanceof NodeError_1.AstNodeError) {
            if (!this.errors.some($ => $.message == error.message && $.node == error.node)) {
                this.errors.push(error);
            }
        }
        else {
            if (!this.errors.some($ => $.message == error && $.node == node)) {
                this.errors.push(new NodeError_1.AstNodeError(error, node));
            }
        }
    }
    warning(message, node) {
        if (!this.errors.some($ => $.message == message && $.node == node)) {
            this.errors.push(new NodeError_1.AstNodeError(message, node, true));
        }
    }
    hasErrors() {
        return this.errors.some($ => !$.warning);
    }
}
exports.ParsingContext = ParsingContext;
class Closure {
    constructor(parsingContext, parent = null) {
        this.parsingContext = parsingContext;
        this.parent = parent;
        this.localsMap = new Map();
        this.localScopeDeclares = new Set();
        this.nameMappings = {};
        this.localUsages = {};
        if (parent) {
            Object.assign(this.nameMappings, parent.nameMappings);
        }
    }
    getInternalIdentifier(node) {
        let prefix = 'identifier_';
        if (node instanceof nodes_1.Nodes.FunctionNode) {
            prefix = node.functionName.name || 'anonFun';
        }
        let i = 0;
        while (true) {
            const newName = i ? `${prefix}${i}` : prefix;
            if (!this.parsingContext.programTakenNames.has(newName)) {
                this.parsingContext.programTakenNames.add(newName);
                return newName;
            }
            i++;
        }
    }
    incrementUsage(name) {
        const x = this.get(name);
        this.localUsages[name] = (this.localUsages[name] || 0) + 1;
        x.usages++;
    }
    set(nameNode, valueNode) {
        const localName = nameNode.name;
        if (localName in this.localUsages && this.localUsages[localName] > 0) {
            throw new Error(`Cannot reasign ${localName} because it was used`);
        }
        if (this.localScopeDeclares.has(localName)) {
            throw new Error(`"${localName}" is already declared`);
        }
        this.nameMappings[localName] = new Reference(nameNode, this, null, valueNode);
        this.localScopeDeclares.add(localName);
        return this.nameMappings[localName];
    }
    canResolveName(localName) {
        return localName in this.nameMappings;
    }
    get(localName) {
        if (localName in this.nameMappings) {
            return this.nameMappings[localName];
        }
        throw new Error('Cannot resolve name "' + localName + '"');
    }
    inspect() {
        return ('Closure [' +
            '\n  ' +
            Object.keys(this.nameMappings).join('\n  ') +
            '\n  parent = ' +
            (this.parent ? '\n' + this.parent.inspect().replace(/^(.*)/gm, '    $1') : 'null') +
            '\n]');
    }
    newChildClosure() {
        return new Closure(this.parsingContext, this);
    }
}
exports.Closure = Closure;
class Reference {
    constructor(referencedNode, scope, moduleSource = null, valueNode) {
        this.referencedNode = referencedNode;
        this.scope = scope;
        this.moduleSource = moduleSource;
        this.valueNode = valueNode;
        this.usages = 0;
    }
    get isLocalReference() {
        return !this.moduleSource;
    }
}
exports.Reference = Reference;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xvc3VyZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNsb3N1cmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxtQ0FBZ0M7QUFDaEMsMkNBQTJDO0FBa0IzQztJQUFBO1FBQ0Usc0JBQWlCLEdBQUcsSUFBSSxHQUFHLEVBQVUsQ0FBQztRQUV0QyxXQUFNLEdBQW1CLEVBQUUsQ0FBQztJQXlCOUIsQ0FBQztJQXJCQyxLQUFLLENBQUMsS0FBNEIsRUFBRSxJQUFpQjtRQUNuRCxJQUFJLEtBQUssWUFBWSx3QkFBWSxFQUFFO1lBQ2pDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLElBQUksS0FBSyxDQUFDLE9BQU8sSUFBSSxDQUFDLENBQUMsSUFBSSxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDOUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDekI7U0FDRjthQUFNO1lBQ0wsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sSUFBSSxLQUFLLElBQUksQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsRUFBRTtnQkFDaEUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSx3QkFBWSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO2FBQ2pEO1NBQ0Y7SUFDSCxDQUFDO0lBRUQsT0FBTyxDQUFDLE9BQWUsRUFBRSxJQUFnQjtRQUN2QyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxJQUFJLE9BQU8sSUFBSSxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxFQUFFO1lBQ2xFLElB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Q2xCLE9BQU8sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDO0lBQzVCLENBQUM7Q0FDRjtBQWJELDhCQWFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTm9kZXMgfSBmcm9tICcuL25vZGVzJztcbmltcG9ydCB7IEFzdE5vZGVFcnJvciB9IGZyb20gJy4vTm9kZUVycm9yJztcblxuZXhwb3J0IGludGVyZmFjZSBJRGljdGlvbmFyeTxUPiB7XG4gIFtrZXk6IHN0cmluZ106IFQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSU92ZXJsb2FkZWRJbmZpeCB7XG4gIFtvcGVyYXRvcjogc3RyaW5nXToge1xuICAgIFtsaHM6IG51bWJlcl06IHtcbiAgICAgIFtyaHM6IG51bWJlcl06IHtcbiAgICAgICAgZm46IE5vZGVzLkZ1bkRpcmVjdGl2ZU5vZGU7XG4gICAgICAgIGRpcmVjdGl2ZTogTm9kZXMuRGlyZWN0aXZlTm9kZTtcbiAgICAgICAgZXhlY3V0aW9uQ29udGV4dDogUGFyc2luZ0NvbnRleHQ7XG4gICAgICB9O1xuICAgIH07XG4gIH07XG59XG5cbmV4cG9ydCBjbGFzcyBQYXJzaW5nQ29udGV4dCB7XG4gIHByb2dyYW1UYWtlbk5hbWVzID0gbmV3IFNldDxzdHJpbmc+KCk7XG5cbiAgZXJyb3JzOiBBc3ROb2RlRXJyb3JbXSA9IFtdO1xuXG4gIGVycm9yKGVycm9yOiBBc3ROb2RlRXJyb3IpO1xuICBlcnJvcihtZXNzYWdlOiBzdHJpbmcsIG5vZGU6IE5vZGVzLk5vZGUpO1xuICBlcnJvcihlcnJvcjogc3RyaW5nIHwgQXN0Tm9kZUVycm9yLCBub2RlPzogTm9kZXMuTm9kZSkge1xuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEFzdE5vZGVFcnJvcikge1xuICAgICAgaWYgKCF0aGlzLmVycm9ycy5zb21lKCQgPT4gJC5tZXNzYWdlID09IGVycm9yLm1lc3NhZ2UgJiYgJC5ub2RlID09IGVycm9yLm5vZGUpKSB7XG4gICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZXJyb3IpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIXRoaXMuZXJyb3JzLnNvbWUoJCA9PiAkLm1lc3NhZ2UgPT0gZXJyb3IgJiYgJC5ub2RlID09IG5vZGUpKSB7XG4gICAgICAgIHRoaXMuZXJyb3JzLnB1c2gobmV3IEFzdE5vZGVFcnJvcihlcnJvciwgbm9kZSkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHdhcm5pbmcobWVzc2FnZTogc3RyaW5nLCBub2RlOiBOb2Rlcy5Ob2RlKSB7XG4gICAgaWYgKCF0aGlzLmVycm9ycy5zb21lKCQgPT4gJC5tZXNzYWdlID09IG1lc3NhZ2UgJiYgJC5ub2RlID09IG5vZGUpKSB7XG4gICAgICB0aGlzLmVycm9ycy5wdXNoKG5ldyBBc3ROb2RlRXJyb3IobWVzc2FnZSwgbm9kZSwgdHJ1ZSkpO1xuICAgIH1cbiAgfVxuXG4gIGhhc0Vycm9ycygpIHtcbiAgICByZXR1cm4gdGhpcy5lcnJvcnMuc29tZSgkID0+ICEkLndhcm5pbmcpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDbG9zdXJlIHtcbiAgbG9jYWxzTWFwOiBNYXA8Tm9kZXMuTm9kZSwgbnVtYmVyPiA9IG5ldyBNYXAoKTtcblxuICBsb2NhbFNjb3BlRGVjbGFyZXM6IFNldDxzdHJpbmc+ID0gbmV3IFNldCgpO1xuICBuYW1lTWFwcGluZ3M6IElEaWN0aW9uYXJ5PFJlZmVyZW5jZT4gPSB7fTtcbiAgbG9jYWxVc2FnZXM6IElEaWN0aW9uYXJ5PG51bWJlcj4gPSB7fTtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgcGFyc2luZ0NvbnRleHQ6IFBhcnNpbmdDb250ZXh0LCBwdWJsaWMgcGFyZW50OiBDbG9zdXJlID0gbnVsbCkge1xuICAgIGlmIChwYXJlbnQpIHtcbiAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5uYW1lTWFwcGluZ3MsIHBhcmVudC5uYW1lTWFwcGluZ3MpO1xuICAgIH1cbiAgfVxuXG4gIGdldEludGVybmFsSWRlbnRpZmllcihub2RlOiBOb2Rlcy5Ob2RlKSB7XG4gICAgbGV0IHByZWZpeCA9ICdpZGVudGlmaWVyXyc7XG5cbiAgICBpZiAobm9kZSBpbnN0YW5jZW9mIE5vZGVzLkZ1bmN0aW9uTm9kZSkge1xuICAgICAgcHJlZml4ID0gbm9kZS5mdW5jdGlvbk5hbWUubmFtZSB8fCAnYW5vbkZ1bic7XG4gICAgfVxuXG4gICAgbGV0IGkgPSAwO1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICBjb25zdCBuZXdOYW1lID0gaSA/IGAke3ByZWZpeH0ke2l9YCA6IHByZWZpeDtcbiAgICAgIGlmICghdGhpcy5wYXJzaW5nQ29udGV4dC5wcm9ncmFtVGFrZW5OYW1lcy5oYXMobmV3TmFtZSkpIHtcbiAgICAgICAgdGhpcy5wYXJzaW5nQ29udGV4dC5wcm9ncmFtVGFrZW5OYW1lcy5hZGQobmV3TmFtZSk7XG4gICAgICAgIHJldHVybiBuZXdOYW1lO1xuICAgICAgfVxuICAgICAgaSsrO1xuICAgIH1cbiAgfVxuXG4gIGluY3JlbWVudFVzYWdlKG5hbWU6IHN0cmluZykge1xuICAgIGNvbnN0IHggPSB0aGlzLmdldChuYW1lKTtcbiAgICB0aGlzLmxvY2FsVXNhZ2VzW25hbWVdID0gKHRoaXMubG9jYWxVc2FnZXNbbmFtZV0gfHwgMCkgKyAxO1xuICAgIHgudXNhZ2VzKys7XG4gIH1cblxuICBzZXQobmFtZU5vZGU6IE5vZGVzLk5hbWVJZGVudGlmaWVyTm9kZSwgdmFsdWVOb2RlOiBOb2Rlcy5FeHByZXNzaW9uTm9kZSkge1xuICAgIGNvbnN0IGxvY2FsTmFtZSA9IG5hbWVOb2RlLm5hbWU7XG5cbiAgICBpZiAobG9jYWxOYW1lIGluIHRoaXMubG9jYWxVc2FnZXMgJiYgdGhpcy5sb2NhbFVzYWdlc1tsb2NhbE5hbWVdID4gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgcmVhc2lnbiAke2xvY2FsTmFtZX0gYmVjYXVzZSBpdCB3YXMgdXNlZGApO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmxvY2FsU2NvcGVEZWNsYXJlcy5oYXMobG9jYWxOYW1lKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBcIiR7bG9jYWxOYW1lfVwiIGlzIGFscmVhZHkgZGVjbGFyZWRgKTtcbiAgICB9XG5cbiAgICB0aGlzLm5hbWVNYXBwaW5nc1tsb2NhbE5hbWVdID0gbmV3IFJlZmVyZW5jZShuYW1lTm9kZSwgdGhpcywgbnVsbCwgdmFsdWVOb2RlKTtcblxuICAgIHRoaXMubG9jYWxTY29wZURlY2xhcmVzLmFkZChsb2NhbE5hbWUpO1xuXG4gICAgcmV0dXJuIHRoaXMubmFtZU1hcHBpbmdzW2xvY2FsTmFtZV07XG4gIH1cblxuICBjYW5SZXNvbHZlTmFtZShsb2NhbE5hbWU6IHN0cmluZykge1xuICAgIHJldHVybiBsb2NhbE5hbWUgaW4gdGhpcy5uYW1lTWFwcGluZ3M7XG4gIH1cblxuICBnZXQobG9jYWxOYW1lOiBzdHJpbmcpOiBSZWZlcmVuY2Uge1xuICAgIGlmIChsb2NhbE5hbWUgaW4gdGhpcy5uYW1lTWFwcGluZ3MpIHtcbiAgICAgIHJldHVybiB0aGlzLm5hbWVNYXBwaW5nc1tsb2NhbE5hbWVdO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHJlc29sdmUgbmFtZSBcIicgKyBsb2NhbE5hbWUgKyAnXCInKTtcbiAgfVxuXG4gIGluc3BlY3QoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgICdDbG9zdXJlIFsnICtcbiAgICAgICdcXG4gICcgK1xuICAgICAgT2JqZWN0LmtleXModGhpcy5uYW1lTWFwcGluZ3MpLmpvaW4oJ1xcbiAgJykgK1xuICAgICAgJ1xcbiAgcGFyZW50ID0gJyArXG4gICAgICAodGhpcy5wYXJlbnQgPyAnXFxuJyArIHRoaXMucGFyZW50Lmluc3BlY3QoKS5yZXBsYWNlKC9eKC4qKS9nbSwgJyAgICAkMScpIDogJ251bGwnKSArXG4gICAgICAnXFxuXSdcbiAgICApO1xuICB9XG5cbiAgbmV3Q2hpbGRDbG9zdXJlKCk6IENsb3N1cmUge1xuICAgIHJldHVybiBuZXcgQ2xvc3VyZSh0aGlzLnBhcnNpbmdDb250ZXh0LCB0aGlzKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUmVmZXJlbmNlIHtcbiAgdXNhZ2VzID0gMDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgcmVmZXJlbmNlZE5vZGU6IE5vZGVzLk5hbWVJZGVudGlmaWVyTm9kZSxcbiAgICBwdWJsaWMgc2NvcGU6IENsb3N1cmUsXG4gICAgcHVibGljIG1vZHVsZVNvdXJjZTogTm9kZXMuTmFtZUlkZW50aWZpZXJOb2RlID0gbnVsbCxcbiAgICBwdWJsaWMgdmFsdWVOb2RlOiBOb2Rlcy5FeHByZXNzaW9uTm9kZVxuICApIHt9XG5cbiAgZ2V0IGlzTG9jYWxSZWZlcmVuY2UoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLm1vZHVsZVNvdXJjZTtcbiAgfVxufVxuIl19